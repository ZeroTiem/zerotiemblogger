<html>
<head>
  <title>C# 抓取使用Google Sheet</title>
  <basefont face="微軟正黑體" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308919 (zh-TW, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微軟正黑體;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="13267"/>

<div>
<span><div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div style="text-align: center;"><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 標楷體; font-weight: bold;">C# 抓取使用Google Sheet</span></font></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">開啟連結(啟用API)</span></div><div><a href="https://console.developers.google.com/" style="font-size: 14pt; font-family: 標楷體;">https://console.developers.google.com/</a></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;"><img src="C 抓取使用Google Sheet_files/Image.png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 14pt; font-family: 標楷體;">[憑證]=&gt;[建立憑證]=&gt;[服務帳戶金鑰]</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;"><img src="C 抓取使用Google Sheet_files/Image [1].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 14pt; font-family: 標楷體;">[新增服務帳戶]=&gt;輸入帳戶名稱，選擇Json</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;"><img src="C 抓取使用Google Sheet_files/Image [2].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 14pt; font-family: 標楷體;">選擇角色=&gt;[服務帳戶]=&gt;[服務帳戶使用者]=&gt;建立</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="標楷體" style="font-size: 12pt;">{</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;type&quot;: &quot;service_account&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;project_id&quot;: &quot;strong-return-249908&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;private_key_id&quot;: &quot;7755c96eaf9a564aa452f3e9b56b78d0bb8cf297&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;private_key&quot;: &quot;-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDAI3w4LVMOcz3i\nflK+lNiRHtCr3ir4Zno6ah/T3tidCWkQP9mKoyHmIqI1I/ESjmL7IjAeNR5OEEc9\n8ToeKCOZljS1nEZ4Id1OVGn7L1P/0M8mIMmp90U22eE4jTVoWGaJ3ouzrX5qyyEO\nT9iQkEXnwvwLAopumyqJqdPJUplv4SAeJk3tQBN5WcS8LTnygLyLUvSnfOhx9XSW\nYu5FX7sA5VKkbC06evRcVK8RyZoXUlj7bQe9s/eetlaNGa/lUWXIU2pQghKAeOQD\nbQ6I8+bx7o1EP7Ar15NFYy1YtLkPJnDm6UiwmQNxYNbEu5PT/zIcwY36CrwMPZH5\nYTDeyyTRAgMBAAECggEAEIjdOe5jQo/rSEWrtD1Al9h+3P4nqixozK8bob2AhvRr\nh1ufSnLNyi1lJ8052T7J830BMWWhKoGfHTcC/oZgwz5YYd/wITV02Iv4z4Yb+fH2\naacSWQnvpGVCoFMSlgde0kgwXdw1JVaUDSm/js1Dnsq6VZjjNdqCN3TscLD8MFLu\nWQ5it9HgozTyejhS1Iv9nAXR32ltwXs2pLKtVZVsb0DF2Rq8JiGhTjtkXNQEsW6v\nZd/28x9wKX+2vYsSV+Oe3eUxMgASszcp5AZ0uiQzXnEhHezw7ciIOVQuIWKG4pf6\nGIxo1BCQcokEn6RSKBvNoagp1eoyTRm4z8o45WQG2wKBgQD7pb/IiUspX9b8d7jv\n+LWPRqlCjmgxTshSGW972F9oUCSENTjE5nQ6yhNgzydsFEAOn0Dhi57/OCG0M9HW\nnSbYUSAdlIJwW02PC2HUhNQ9F8pby88aukxMgPFXQmTHV0A766bYpq0rUZZipCUg\nNrpCsb/sLsXjx0XQJNWjoUXQvwKBgQDDdj3I8j1DQnr3c6XNGEB57RdGesPCfzVz\naO0mt1knNmvjvHAnBgvZcyz7LxsAzexzBT0vvx49a9Q1iKuWHpjN5eRptULJ145f\nA7lWLVPFuTmhZUgvOC27Ylux1tNDsoThERXBYZ9SQqkbPl/imXsdNlD2HsHlWfH1\nZuSfuYDebwKBgE3a9f7hGzPtxuHNWJZF6EYvomZJEMtQiIF+BRPX2Yy4XtPYc3vX\noNYfdudYr+WsTjU36Cbfv41OnH7YGW/Apyf90WXVcJW6acB70QSjI9bS6XSFFco7\nISf6LLDGhc92mxTuz2vwBVuFnnVeO25AAFhqDerQfcD/AgZnnwFFAAiZAoGAFOj6\nVRvtB9v90akSjK1SgHinq8eIV69KJY2NCT5GEFbXFebbzKDt9ZZHsptodR6Sc/+U\nex4j+wglDJERYh7l0+kLFW/ptDQWK/32/swckSNukeCG515ILiqoio7jzPM1Geq8\n/BIYfDFba+mxUkl/DTH5WUsTDRkhNFKMlLXAnosCgYA8UTvE9AoqP9sJlbdKMzFg\niV+uE7BsQLacZDw9teYcMINhPctSxbci4m0tqmxHtXQKzmR4OEOps96FIZ1AzV12\nkWweNEteFXmtYWuZy7bO+d6N0/ZsBJYdIn0yQUNTvfmWzkHvJOBRdH/+c3tqpRxb\nQEMQhZN75gqODEptv8klVw==\n-----END PRIVATE KEY-----\n&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;client_email&quot;: &quot;<font color="#FF0000">demo-773@strong-return-249908.iam.gserviceaccount.com</font>&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;client_id&quot;: &quot;113574010255007771498&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;auth_uri&quot;: &quot;https://accounts.google.com/o/oauth2/auth&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;token_uri&quot;: &quot;https://oauth2.googleapis.com/token&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;auth_provider_x509_cert_url&quot;: &quot;https://www.googleapis.com/oauth2/v1/certs&quot;,</font></div><div><font face="標楷體" style="font-size: 12pt;">&quot;client_x509_cert_url&quot;: &quot;https://www.googleapis.com/robot/v1/metadata/x509/demo-773%40strong-return-249908.iam.gserviceaccount.com&quot;</font></div><div><font face="標楷體" style="font-size: 12pt;">}</font></div></div><div><span style="white-space: pre;"><span style="font-size: 14pt; font-family: 標楷體;">會下載一份Json檔案請保存起來，內容會像是上方資訊</span></span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">接下來到要存取的文件檔案去加入此帳戶的存取權限(email帳號可以在json檔案內確認)</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;"><img src="C 抓取使用Google Sheet_files/Image [3].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 14pt; font-family: 標楷體;">[檔案]=&gt;[共用]</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;"><img src="C 抓取使用Google Sheet_files/Image [4].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 14pt; font-family: 標楷體;">輸入Mail=&gt;給權限可以編輯=&gt;傳送</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 12pt; font-family: 標楷體;">https://docs.google.com/spreadsheets/d/</span><span style="font-size: 12pt; color: rgb(255, 0, 0); font-family: 標楷體;">1wLRt6fA8QsdS3swwCgrYQ5UpfBGFpLSaaUswDvc3ifI</span><span style="font-size: 12pt; font-family: 標楷體;">/edit#gid=0</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">取得spreadsheetsid:紅色文字部分</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">安裝套件</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">Install-Package Google.Apis.Sheets.v4</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">.NET 版本 .net framework 4.6.1</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">範例</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="標楷體" style="font-size: 12pt;">class Program</font></div><div><font face="標楷體" style="font-size: 12pt;">    {</font></div><div><font face="標楷體" style="font-size: 12pt;">        private static string[] Scopes = { SheetsService.Scope.SpreadsheetsReadonly };  // Change this if you're accessing Drive or Docs</font></div><div><font face="標楷體" style="font-size: 12pt;">        static void Main(string[] args)</font></div><div><font face="標楷體" style="font-size: 12pt;">        {</font></div><div><font face="標楷體" style="font-size: 12pt;">            GoogleCredential credential;</font></div><div><font face="標楷體" style="font-size: 12pt;">            // Put your credentials json file in the root of the solution and make  sure copy to output dir property is set to always copy</font></div><div><font face="標楷體" style="font-size: 12pt;">            using (var stream =</font></div><div><font face="標楷體" style="font-size: 12pt;">                new FileStream(&quot;ServiceToken.json&quot;, FileMode.Open, FileAccess.Read)</font></div><div><font face="標楷體" style="font-size: 12pt;">            )</font></div><div><font face="標楷體" style="font-size: 12pt;">            {</font></div><div><font face="標楷體" style="font-size: 12pt;">                credential = GoogleCredential.FromStream(stream).CreateScoped(Scopes);</font></div><div><font face="標楷體" style="font-size: 12pt;">            }</font></div><div><font face="標楷體" style="font-size: 12pt;">            // Create Google Sheets API service.</font></div><div><font face="標楷體" style="font-size: 12pt;">            var service = new SheetsService(new BaseClientService.Initializer()</font></div><div><font face="標楷體" style="font-size: 12pt;">            {</font></div><div><font face="標楷體" style="font-size: 12pt;">                </font></div><div><font face="標楷體" style="font-size: 12pt;">                HttpClientInitializer = credential,</font></div><div><font face="標楷體" style="font-size: 12pt;">                //ApplicationName = ApplicationName,</font></div><div><font face="標楷體" style="font-size: 12pt;">            });</font></div><div><font face="標楷體" style="font-size: 12pt;">            // Define request parameters.</font></div><div><font face="標楷體" style="font-size: 12pt;">            String spreadsheetId = &quot;1wLRt6fA8QsdS3swwCgrYQ5UpfBGFpLSaaUswDvc3ifI&quot;;</font></div><div><font face="標楷體" style="font-size: 12pt;">            String range = &quot;Sheet1!A1:B2&quot;;</font></div><div><font face="標楷體" style="font-size: 12pt;">            SpreadsheetsResource.ValuesResource.GetRequest request =</font></div><div><font face="標楷體" style="font-size: 12pt;">                    service.Spreadsheets.Values.Get(spreadsheetId, range);</font></div><div><font face="標楷體" style="font-size: 12pt;">            // Prints the names and majors of students in a sample spreadsheet:</font></div><div><font face="標楷體" style="font-size: 12pt;">            //  https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit</font></div><div><font face="標楷體" style="font-size: 12pt;">            ValueRange response = request.Execute();</font></div><div><font face="標楷體" style="font-size: 12pt;">            IList&lt;IList&lt;Object&gt;&gt; values = response.Values;</font></div><div><font face="標楷體" style="font-size: 12pt;">            if (values != null &amp;&amp; values.Count &gt; 0)</font></div><div><font face="標楷體" style="font-size: 12pt;">            {</font></div><div><font face="標楷體" style="font-size: 12pt;">                Console.WriteLine(&quot;Name, Major&quot;);</font></div><div><font face="標楷體" style="font-size: 12pt;">                foreach (var row in values)</font></div><div><font face="標楷體" style="font-size: 12pt;">                {</font></div><div><font face="標楷體" style="font-size: 12pt;">                    // Print columns A and E, which correspond to indices 0 and 4.</font></div><div><font face="標楷體" style="font-size: 12pt;">                    Console.WriteLine(&quot;{0}, {1}&quot;, row[0], row[1]);</font></div><div><font face="標楷體" style="font-size: 12pt;">                }</font></div><div><font face="標楷體" style="font-size: 12pt;">            }</font></div><div><font face="標楷體" style="font-size: 12pt;">            else</font></div><div><font face="標楷體" style="font-size: 12pt;">            {</font></div><div><font face="標楷體" style="font-size: 12pt;">                Console.WriteLine(&quot;No data found.&quot;);</font></div><div><font face="標楷體" style="font-size: 12pt;">            }</font></div><div><font face="標楷體" style="font-size: 12pt;">            Console.Read();</font></div><div><font face="標楷體" style="font-size: 12pt;">        }</font></div><div><font face="標楷體" style="font-size: 12pt;">    }</font></div></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">new FileStream(&quot;ServiceToken.json&quot;, FileMode.Open, FileAccess.Read)</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">ServiceToken.json 更改成剛剛下載的Json檔案路徑</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">String spreadsheetId = &quot;1wLRt6fA8QsdS3swwCgrYQ5UpfBGFpLSaaUswDvc3ifI&quot;;</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">spreadsheetId 就是Url 擷取下來的部分</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">補充</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">獲取和使用API密鑰</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">對Google表格API請求公共數據的請求必須附帶一個標識符，該標識符可以是API密鑰或 訪問令牌。</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">要獲取API密鑰：</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">1. 在API控制台中打開“ 憑據”頁面。</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">2. 此API支持兩種類型的憑據。創建適合您項目的憑據：</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">    * OAuth 2.0：每當您的應用程序請求私人用戶數據時，它必須與請求一起發送OAuth 2.0令牌。您的應用程序首先發送客戶端ID，並可能發送客戶端密鑰以獲取令牌。您可以為Web應用程序，服務帳戶或已安裝的應用程序生成OAuth 2.0憑據。</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">有關更多信息，請參閱OAuth 2.0文檔。</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">    * API密鑰： 不提供OAuth 2.0令牌的請求必鬚髮送API密鑰。密鑰標識您的項目並提供API訪問權限，配額和報告。</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">API支持API密鑰的幾種類型的限制。如果您所需的API密鑰尚不存在，則通過單擊“ 創建憑據”&gt;“API密鑰”在控制台中創建API密鑰。通過單擊“ 限制”鍵並選擇“ 限制”之一， 可以在生產中使用密鑰之前限制密鑰。</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">要確保API密鑰安全，請遵循安全使用API密鑰的最佳做法。</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">擁有API密鑰後，您的應用程序可以將查詢參數附加 到所有請求URL。key=yourAPIKey</span></div><div><span style="font-size: 14pt; font-family: 標楷體;">API密鑰可以安全地嵌入到URL中; 它不需要任何編碼。</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><a href="https://developers.google.com/sheets/api/guides/authorizing" style="font-size: 14pt; font-family: 標楷體;">https://developers.google.com/sheets/api/guides/authorizing</a></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><hr/><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div style="text-align: center;"><span style="font-size: 14pt; font-family: 標楷體;">參考資料</span></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">Google 官方文件</span></div><div><a href="https://developers.google.com/sheets/api/quickstart/dotnet" style="font-size: 14pt; font-family: 標楷體;">https://developers.google.com/sheets/api/quickstart/dotnet</a></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 標楷體;">教學文件</span></div><div><a href="https://medium.com/%40williamchislett/writing-to-google-sheets-api-using-net-and-a-services-account-91ee7e4a291" style="font-size: 14pt; font-family: 標楷體;">https://medium.com/@williamchislett/writing-to-google-sheets-api-using-net-and-a-services-account-91ee7e4a291</a></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div><div><font face="標楷體" style="font-size: 14pt;"><br/></font></div></div><div><br/></div></span>
</div></body></html> 