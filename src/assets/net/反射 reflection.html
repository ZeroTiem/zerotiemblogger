<html>
<head>
  <title>反射 reflection</title>
  <basefont face="微軟正黑體" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308919 (zh-TW, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微軟正黑體;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="3125"/>

<div>
<span><div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">reflection interfaces c#</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><a href="https://msdn.microsoft.com/en-us/library/ayfa0fcd%28v=vs.110%29.aspx" style="font-size: 10pt;">https://msdn.microsoft.com/en-us/library/ayfa0fcd%28v=vs.110%29.aspx</a></div><div><span style="font-size: 10pt;">For generic interfaces, the </span><span style="font-size: 10pt; font-style: italic;">name</span><span style="font-size: 10pt;"> parameter is the mangled name, ending with a grave accent (`) and the number of type parameters. This is true for both generic interface definitions and constructed generic interfaces. For example, to find </span><span style="font-size: 10pt; color: rgb(0, 100, 0); font-family: Consolas, Courier, monospace;">IExample&lt;T&gt;</span><span style="font-size: 10pt;">(</span><span style="font-size: 10pt; color: rgb(0, 100, 0); font-family: Consolas, Courier, monospace;">IExample(Of T)</span><span style="font-size: 10pt;"> in Visual Basic) or </span><span style="font-size: 10pt; color: rgb(0, 100, 0); font-family: Consolas, Courier, monospace;">IExample&lt;string&gt;</span><span style="font-size: 10pt;"> (</span><span style="font-size: 10pt; color: rgb(0, 100, 0); font-family: Consolas, Courier, monospace;">IExample(Of String)</span><span style="font-size: 10pt;"> in Visual Basic), search for </span><span style="font-size: 10pt; color: rgb(0, 100, 0); font-family: Consolas, Courier, monospace;">&quot;IExample`1&quot;</span><span style="font-size: 10pt;">.</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">調用方法</span></div><div align="left" style="min-height: 11pt;"><span style="font-size: 10pt; font-family: MingLiU;">  </span> <span style="font-size: 10pt; color: rgb(43, 145, 175); font-family: MingLiU;">Type</span> <span style="font-size: 10pt; font-family: MingLiU;">virtualmachine = _virtualmachine.GetType();</span></div><div align="left" style="min-height: 11pt;"><span style="font-size: 10pt; font-family: MingLiU;">           </span> <span style="font-size: 10pt; color: rgb(43, 145, 175); font-family: MingLiU;">MethodInfo</span> <span style="font-size: 10pt; font-family: MingLiU;">myMethodInfo = virtualmachine.GetMethod(CommandKey);</span></div><div align="left" style="min-height: 11pt;"><span style="font-size: 10pt; font-family: MingLiU;">           </span> <span style="font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">object</span><span style="font-size: 10pt; font-family: MingLiU;">[] mParam =</span> <span style="font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">new</span> <span style="font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">object</span><span style="font-size: 10pt; font-family: MingLiU;">[] { 5, 10 };</span></div><div align="left" style="min-height: 11pt;"><div><span style="font-family: MingLiU; font-size: 10pt;">            myMethodInfo.Invoke(virtualmachine, mParam);</span></div></div><div><a href="http://sunskynote.blogspot.tw/2015/05/reflection-c.html" style="font-size: 10pt;">http://sunskynote.blogspot.tw/2015/05/reflection-c.html</a></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><br/></font></div><div style="min-height: 11pt; text-align: left;"><span style="font-size: 10pt;">Json</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;"> </span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">private</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">Dictionary&lt;</span><span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">string</span><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">,</span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">string</span><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">&gt; GetFields&lt;</span><span style="min-height: 11pt; font-size: 10pt; color: rgb(43, 145, 175); font-family: MingLiU;">T</span><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">&gt;(T fieldsInst)</span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">where</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">T :</span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">class</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt;"><span style="font-family: MingLiU; font-size: 10pt;">        {</span></span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">           </span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">var</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">fieldsDictionary =</span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">new</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">Dictionary&lt;</span><span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">string</span><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">,</span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">string</span><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">&gt;();</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">           </span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">var</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">myPropertyInfo = fieldsInst.GetType().GetProperties();</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">           </span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">foreach</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">(var p</span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">in</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">myPropertyInfo)</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt;"><span style="font-family: MingLiU; font-size: 10pt;">            {</span></span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">               </span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">var</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">propertyName = p.</span><span style="min-height: 11pt; font-size: 10pt; color: rgb(255, 0, 0); font-family: MingLiU;">GetCustomAttribute</span><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">&lt;JsonPropertyAttribute&gt;()?.PropertyName;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">               </span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">var</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">name = !</span><span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">string</span><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">.IsNullOrWhiteSpace(propertyName) ? propertyName : p.Name;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt;"><span style="font-family: MingLiU; font-size: 10pt;">                fieldsDictionary[name] = p.GetValue(fieldsInst).ToString();</span></span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt;"><span style="font-family: MingLiU; font-size: 10pt;">            }</span></span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">           </span> <span style="min-height: 11pt; font-size: 10pt; color: rgb(0, 0, 255); font-family: MingLiU;">return</span> <span style="min-height: 11pt; font-size: 10pt; font-family: MingLiU;">fieldsDictionary;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt;"><span style="font-family: MingLiU; font-size: 10pt;">        }</span></span></div><div style="min-height: 11pt; text-align: left;"></div><hr/><div style="min-height: 11pt; text-align: left;"></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt;"><span style="font-family: MingLiU; font-size: 10pt;">Enum</span></span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;"> </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">public</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">static</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">Dictionary&lt;</span><span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">int</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">, TType&gt; ToDictionaryByEnumAttribute&lt;</span><span style="min-height: 11pt; font-family: MingLiU; color: rgb(43, 145, 175); font-size: 9pt;">TEnum</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">,</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(43, 145, 175); font-size: 9pt;">TAttribute</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">,</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(43, 145, 175); font-size: 9pt;">TType</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">&gt;(Expression&lt;Func&lt;TAttribute, TType&gt;&gt; expression)</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">           </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">where</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">TEnum : Enum</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">           </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">where</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">TAttribute : System.Attribute</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">        {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">           </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">var</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">fieldsDictionary =</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">new</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">Dictionary&lt;</span><span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">int</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">, TType&gt;();</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">           </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">if</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">(!(expression.Body</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">is</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">MemberExpression memberExpression))</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">            {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">               </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">return</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">fieldsDictionary;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">            }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">           </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">var</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">customAttributeName = memberExpression.Member.Name;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">           </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">foreach</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">(</span><span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">int</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">enumValue</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">in</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">Enum.GetValues(</span><span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">typeof</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">(TEnum)))</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">            {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">               </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">var</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">productEnum = (TEnum)Enum.ToObject(</span><span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">typeof</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">(TEnum), enumValue);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">               </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">var</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">customAttribute =</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                    productEnum</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        .GetType()</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        .GetMember(productEnum.ToString())</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        .FirstOrDefault()</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        ?.GetCustomAttributes(</span><span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">typeof</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">(TAttribute),</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">false</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">)</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        .FirstOrDefault();</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">               </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">var</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">customAttributeValue =</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                    customAttribute</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        ?.GetType()</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        .GetProperty(customAttributeName)</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                        ?.GetValue(customAttribute,</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">null</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">               </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">if</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">(customAttributeValue !=</span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">null</span><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">)</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                    fieldsDictionary.Add(enumValue, (TType)customAttributeValue);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">                }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">            }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">           </span> <span style="min-height: 11pt; font-family: MingLiU; color: rgb(0, 0, 255); font-size: 9pt;">return</span> <span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">fieldsDictionary;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-family: MingLiU; font-size: 9pt;">        }</span><br/></div></div></span>
</div></body></html> 